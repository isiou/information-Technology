# 数据库病毒处理

当云服务器报毒（一般以短信、电话、邮件等形式提示）时，若为挖矿病毒（如图所示）则需手动进行处理。

![1](https://oss.isiou.cn/PicGo/202407051721508.png)

当服务器中挖矿病毒后，挖矿程序会一直以高占用贮存在后台，极其消耗服务器性能资源。若不进行处理则可能导致服务器宕机、被云服务商封禁等后果。

## 处理步骤

1. 当收到服务器应急短信后，则需尽快登录云服务器控制台，查看所中病毒类型、路径等（以阿里云服务器为例）：

   ![2](https://oss.isiou.cn/PicGo/202407051724825.png)

2. 阅读事件详细信息，例如图所示：

   ![3](https://oss.isiou.cn/PicGo/202407051725168.png)

   由详细信息可知，此病毒为挖矿程序，且文件目录位于 `/var/tmp/ge (deleted)` 的 `gBcZgJv` 进程。

3. 通过 SSH 登录服务器：

   - 通过 `top` 查找服务器占用资源较高的进程，如图所示：

     ![4](https://oss.isiou.cn/PicGo/202407051720486.png)

     可发现 `SjLvc1b` 进程 CPU 资源占用极高，又因为其不是可知进程，大概率为病毒进程。

   - 通过 `ps aux | grep SjLvc1b` 查询此进程的 ID：

     ![5](https://oss.isiou.cn/PicGo/202407051733981.png)

     查询后可知此进程 ID 为 12658，使用 `readlink -f /proc/12658/exe` 查询此进程的文件，发现其已被删除，但进程未释放。

     使用 `kill -9 12658` 结束此进程。

     再次查询，发现此进程已不存在：

     ![6](https://oss.isiou.cn/PicGo/202407051736867.png)

4. 进行上述步骤后便结束了病毒进程，若为保险则推荐清理 `/tmp` 文件夹下文件。使用 `rm -rf /tmp/*` 进行清理，注意当前是否有进程需要使用此文件夹下临时文件。

## 预防

1. 对于服务器和数据库，需要设置较高强度密码，推荐使用大小写字母、数字、特殊符号进行组合。

2. 对于数据库，确保数据库的安全性，尽量不要将数据库暴露在所有公网上，设置连接权限等，避免因不怀好意之人扫描端口后使用弱密码连接数据库。

## 其他病毒或应急事件

对于其他病毒或入侵事件，则需要根据实际情况进行良好的应对。病毒种类有很多，如挖矿、木马、DDOS 攻击等。若需处理此类应急事件，需要进行不同的设置、加强防范。

判断病毒类型可以根据其主要影响判断，例如服务器资源高占用，配置文件被篡改等。
